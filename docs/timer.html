<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>Timer</title>
    <script src="easytimer-4.1.1.js"></script>
    <style>
        #references {
            position: fixed;
            bottom: 0;
            right: 0;
        }

        #timerWrapper {
            text-align: center;
            font-size: 25vw;
        }

        #buttonWrapper {
            width: 100%;
            position: fixed;
            bottom: 0;
            text-align: center;
            font-size: 400%;
        }

        #setTimeWrapper {
            display: none;
            text-align: center;
            vertical-align: center;
            background-color: lightblue;
            position: fixed;
            left: 15vw;
            bottom: 15vw;
            top: 15vh;
            right: 15vw;
            font-size: 10vw;
        }

        input, button {
            font-size: 10vw;
        }

    </style>

</head>
<body id='body'>


<div id="timerWrapper">
    <div id="timerDiv"></div>
</div>

<div id="setTimeWrapper">
    <form id="setTime">
        <input type="tel" min="1" max="60" size="3"
               pattern="[0-9]{1,2}"
               value="4"
               required
        >
        <button value="Set timer">Set timer</button>
    </form>

</div>
<div id="buttonWrapper">
    <a href="#" id="setTimerButton">Set timer</a>
    <a href="#" id="startButton">Start</a>
    <a href="#" id="stopButton">Stop</a>
</div>

<div id="references">
    <a href="https://albert-gonzalez.github.io/easytimer.js/">Timer library</a>
    <a href="https://github.com/igorrosenberg/js_playground">Dev home</a>
</div>

<script>

    function getColor(currentTime) {
        var color = undefined;
        if (currentTime.minutes > 0) {
            color = 'white';
        } else {
            if (currentTime.seconds > 30) {
                color = 'lightgreen';
            } else {
                if (currentTime.seconds > 10) {
                    color = 'yellow';
                } else {
                    if (currentTime.seconds > 0) {
                        color = 'orange';
                    } else
                        color = 'red';
                }
            }
        }
        return color;
    }

    var timer = new easytimer.Timer();
    var $timerDiv = document.getElementById('timerDiv');

    var initialTime = 4;

    update({minutes: initialTime, seconds: 0});


    function update(currentTime) {

        document.body.style.backgroundColor = getColor(currentTime);
        var currentTimeString = "";
        if (currentTime.minutes < 10)
            currentTimeString += "0";
        currentTimeString += currentTime.minutes;
        currentTimeString += ":";
        if (currentTime.seconds < 10)
            currentTimeString += "0";
        currentTimeString += currentTime.seconds;
        $timerDiv.innerText = currentTimeString;
    }

    timer.addEventListener('secondsUpdated', function (e) {
        update(timer.getTimeValues());
    });
    // timer.addEventListener('targetAchieved', function (e) {});

    document.getElementById('startButton').addEventListener('click', function (e) {
        timer.stop();
        timer.start(
            {countdown: true, startValues: {seconds: 60 * initialTime}}
        );
        return false;
    });

    document.getElementById('stopButton').addEventListener('click', function (e) {
        timer.stop();
        return false;
    });

    var $setTimeWrapper = document.getElementById('setTimeWrapper');

    document.getElementById('setTimerButton').addEventListener('click', function (e) {
        $setTimeWrapper.style.display = 'block';    // "modal" appears
        return false;
    });

    var form = document.getElementsByTagName("form")[0];
    form.addEventListener('submit', function (e) {
        timer.stop();
        $setTimeWrapper.style.display = 'none';     // "modal" hide
        initialTime = parseInt(form[0].value, 10);
        update({minutes: initialTime, seconds: 0});
        e.preventDefault();                         // no form bubbling
    });


</script>


</body>
</html>

